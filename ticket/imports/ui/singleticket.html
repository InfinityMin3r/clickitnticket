<!-- This page displays a single ticket and comments.  Certain fields are restricted to authenticated viewers, as is the resolve button and comment add field. -->

<template name="singleticket">

  <div class="btn-group" role="group" aria-label="..." id="navrole">
        {{#if currentUser}}
            <!-- all user should have  -->
            <a href="/view" class="btn btn-info" style="margin-bottom: 10px" >Return to Ticket List</a>
            <button class="btn btn-info" id="logout" style="margin-bottom: 10px" >Log Out</button>
        {{else}}
            <!-- if guest -->
            <a href="/" class="btn btn-info" style="margin-bottom: 10px" >Return Home</a>
        {{/if}}
        {{#if isInRole 'Admin'}}
            <!-- if admin -->
            <a href="/admin" class="btn btn-info" style="margin-bottom: 10px"> Admin </a>
        {{/if}}
    </div>
    <br />
    <!-- This section displays the info for the ticket -->
    {{#if hide}}
        {{#if isInRole "Admin"}}
            <div class="container ticket-list">
                <label><h1><span id="ticketnum">{{number}}<br /></span><h3>{{summary}}</h3></h1></label>
                <li>
                    <p><strong>Created at: </strong>{{createdAt}}</p>
                    <p><strong>Reported by: </strong>{{namein}}</p>
                    <p><strong>Contact Email: </strong>{{rpiemail}}</p>
                    {{#if altemail}}
                        <p><strong>Alternate Email: </strong>{{altemail}}</p>
                    {{/if}}
                    <p><strong>Contact Phone: </strong>{{phonein}}</p>
                    {{#if currentUser}}
                        <p><strong>Submitted By: </strong>{{youremail}}</p>
                    {{/if}}
                    <p><strong>Issue Type: </strong>{{issuetype}}</p>
                    {{#if currentUser}}
                        <p><strong>Priority: </strong>{{priority}}</p>
                    {{/if}}
                    <p><strong>Description: </strong>{{description}}</p>
                    <p><strong>Status: </strong>
                    {{#if status}}
                        New Ticket
                    {{else}}
                        Resolved
                    {{/if}}
                    </p>
                    <p><strong>Closed: </strong>
                    {{#if close}}
                        Yes
                    {{else}}
                        No
                    {{/if}}
                    </p>

                    <div class="btn-group" role="group" aria-label="...">
                            {{#if close}}
                                <button class="btn btn-success btn-block btn-notclose">Open</button>
                            {{else}}
                                {{#if status}}
                                        <button class="btn btn-success btn-resolve">Resolve</button>
                                {{else}}
                                        <button class="btn btn-success btn-reopen">Unresolve</button>
                                {{/if}}
                                {{#if blockComments}}
                                    <button class="btn btn-danger btn-alcom">Allow commenting</button>
                                {{else}}
                                    <button class="btn btn-danger btn-nocom">Disable commenting</button>
                                {{/if}}
                                <button class="btn btn-danger btn-show">Show</button>
                            {{/if}}
                    </div>
                </li>
            </div>
        {{else}}
            <div class="container ticket-list">
                <label><h1><span id="ticketnum">{{number}}<br /></span><h3>The information is not visible to the user</h3></h1></label>
            </div>
        {{/if}}

    {{else}}
        <div class="container ticket-list">
            <label><h1><span id="ticketnum">{{number}}<br /></span><h3>{{summary}}</h3></h1></label>
            <li>
                <p><strong>Created at: </strong>{{createdAt}}</p>
                <p><strong>Reported by: </strong>{{namein}}</p>
                {{#if currentUser}}
                    <p><strong>Contact Email: </strong>{{rpiemail}}</p>
                {{/if}}
                {{#if altemail}}
                    <p><strong>Alternate Email: </strong>{{altemail}}</p>
                {{/if}}
                {{#if currentUser}}
                    <p><strong>Contact Phone: </strong>{{phonein}}</p>
                {{/if}}
                {{#if currentUser}}
                    <p><strong>Submitted By: </strong>{{youremail}}</p>
                {{/if}}
                <p><strong>Issue Type: </strong>{{issuetype}}</p>
                {{#if currentUser}}
                    <p><strong>Priority: </strong>{{priority}}</p>
                {{/if}}
                <p><strong>Description: </strong>{{description}}</p>
                <p><strong>Status: </strong>
                {{#if status}}
                    New Ticket
                {{else}}
                    Resolved
                {{/if}}
                </p>
                <p><strong>Closed: </strong>
                {{#if close}}
                    Yes
                {{else}}
                    No
                {{/if}}
                </p>

                <div class="btn-group" role="group" aria-label="...">
                    {{#if currentUser}}
                        {{#if close}}
                            {{#if isInRole "Admin"}}
                                <button class="btn btn-success btn-block btn-notclose">Open</button>
                            {{/if}}
                        {{else}}
                            {{#if isInRole "Help Desk"}}
                                {{#if creator}}
                                    {{#if status}}
                                        <button class="btn btn-success btn-resolve">Resolve</button>
                                    {{else}}
                                        <button class="btn btn-success btn-reopen">Unresolve</button>
                                    {{/if}}
                                {{else}}
                                {{/if}}
                            {{else}}
                                {{#if status}}
                                    <button class="btn btn-success btn-resolve">Resolve</button>
                                {{else}}
                                    <button class="btn btn-success btn-reopen">Unresolve</button>
                                {{/if}}
                                {{#if isInRole "Admin"}}
                                    <button class="btn btn-danger btn-close">Close</button>
                                    {{#if blockComments}}
                                        <button class="btn btn-danger btn-alcom">Allow commenting</button>
                                    {{else}}
                                        <button class="btn btn-danger btn-nocom">Disable commenting</button>
                                    {{/if}}
                                    {{#if hide}}
                                        <button class="btn btn-danger btn-show">Show</button>
                                    {{else}}
                                        <button class="btn btn-danger btn-hide">Hide</button>
                                    {{/if}}
                                {{/if}}
                            {{/if}}
                        {{/if}}
                    {{/if}}
                </div>

            </li>
        </div>
    {{/if}}
  <!-- This section displays each existing comment and the add comment field for authenticated viewers -->
    <div>
        <h1 style="text-align: center">Comments:</h1>
        {{#each comments}}
            <div class="container ticket-list">
                <h4>{{author}}</h4>
                <p><em>{{time}}</em></p>
                <p>{{{body}}}</p>
            </div>
            <br />
        {{/each}}
        {{#if currentUser}}
            <form class="container ticket-list">

            {{#if close}}
                <p style="width: 100%; margin-bottom: 0px"><em>Ticket is closed, commenting disabled.</em></p>
            {{else}}
                {{#if blockComments}}
                    <p style="width: 100%; margin-bottom: 0px"><em>Commenting are disabled to users.</em></p>
                {{else}}
                    {{#if status}}
                        <input type="text" id="commentbody" style="width: 100%;" placeholder="Add comment..." />
                    {{else}}
                        <p style="width: 100%; margin-bottom: 0px"><em>Ticket is resolved, commenting disabled.</em></p>
                    {{/if}}
                {{/if}}
            {{/if}}
            </form>
            <br />
        {{/if}}
    </div>

</template>
